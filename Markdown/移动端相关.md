# 面试记录

## 性能优化

- 图片懒加载
- 节流和防抖
- SPA首屏加载优化
  - JavaScript文件过大：SPA通常有很多 JavaScript 文件，如果这些文件的大小过大或加载速度慢，就会导致首屏加载缓慢。可以通过代码分割和打包、使用CDN等方式来优化加载速度。
  - 数据请求过多或数据请求太慢：SPA通过 AJAX 或 Fetch 等方式从后端获取数据，如果数据请求过多或数据请求太慢，也会导致首屏加载缓慢。可以通过减少数据请求、使用数据缓存、优化数据接口等方式来优化数据请求速度。
  - 大量图片加载慢：如果首屏需要加载大量图片，而这些图片大小过大或加载速度慢，也会导致首屏加载缓慢。可以通过图片压缩、使用图片懒加载等方式来优化图片加载速度。
  - 过多的渲染和重绘操作：如果在首屏加载时进行大量的渲染和重绘操作，也会导致首屏加载缓慢。可以通过尽可能少的DOM操作、使用CSS3动画代替JS动画等方式来优化渲染和重绘操作。
  - 网络问题：网络问题也会影响SPA首屏加载速度，比如网络延迟、丢包等。可以通过使用CDN、使用HTTP/2等方式来优化网络问题。

> 为什么要做性能优化
>
> 性能优化是为了提高网页的加载速度和相应速度，给用户带来更好的体验和用户满意度，同时还能减少服务器的负载压力，以此来提升程序的稳定性

> 258原则
>
> 2：页面的加载时间应该控制在2秒以内，这是用户能够接受的最短时间。
> 5：页面的加载时间在5秒以内，用户对页面加载速度的不满意度开始上升。
> 8：页面的加载时间超过8秒，用户的流失率将急剧增加，用户很可能会放弃访问该页面。

> HTML&CSS
>
> 1. 减少DOM数量，减轻浏览器渲染计算负担。
> 2. 使用异步和延迟加载js文件，避免js文件阻塞页面渲染
> 3. 压缩HTML、CSS代码体积，删除不要的代码，合并CSS文件，减少HTTP请求次数和请求大小。
> 4. 减少CSS选择器的复杂程度，复杂度与阿高浏览器解析时间越长。
> 5. 避免使用CSS表达式在javascript代码中
> 6. 使用css渲染合成层如transform、opacity、will-change等，提高页面相应速度减少卡顿现象。
> 7. 动画使用CSS3过渡，减少动画复杂度，还可以使用硬件加速。

## 小程序生命周期

> app
>
> - onlaunch 小程序注册，执行一次
> - onshow 小程序唤起前台展示
> - onhide 小程序前台隐藏
> - onerror 小程序出错
> - onPageNotFound 小程序要打开的页面不存在的时候触发
> - onUnhandledRejection 小程序有未处理的 Promise inject的时候触发；
> - onThemeChange 系统切换主题的时候触发

> page
>
> - onload 初始化注册，执行一次
> - onshow 前台展示
> - onready 初次渲染完成，执行一次
> - onhide 页面切换
> - onunload 页面销毁

> compontent >>> lifetimes
>
> - created 组件实例刚刚被创建好的时候触发
> - attached 当组件完全初始化完毕、进入页面节点树之后被触发
> - ready 当组件在视图层布局完成之后被触发
> - moved 在组件实例被移动到节点树另一个位置的时候被触发
> - detached 在组件离开页面节点树之后被触发
> - error 每当组件方法中抛出错误的时候被触发

## 移动端兼容

> 300ms延迟
>   - fastclick
>   - 阻止默认
  ```js
  document.addEventListener("touchstart", function(event) {
    if (event.touches.length > 1) {
      event.preventDefault();
    }
  })
  document.addEventListener("gesturestart", function(event) {
    event.preventDefault();
  })
  ```
> 安卓部分版本input的placeholder偏上
>   - input的line-height设为normal
> ios的body设置overflow:hidden仍然可以滚动
>   - 一般在所有元素最外层再包一个大盒子.wrap `.wrap{ position:relative; overflow:hidden; }`
> ios 滚动不流畅
>   - `-webkit-overflow-scrolling: touch;`
> html滚动优化
>  - Pc端
  ```css
  /* 禁止在页面滚动时鼠标频繁触发事件 */
  body {
    pointer-events: none;
  }
  ```
  ```javascript
  let timer = null

  window.addEventListener("scroll", function () {
    // 滚动时禁用鼠标事件
    document.body.style.pointerEvents = 'none';
    if (timer) { clearTimeout(timer) }
    timer = setTimeout(() => {
      // 释放
      document.body.style.pointerEvents = 'auto';
    }, 100);
  })
  ```
> - 移动端
  ```css
  /* 阻止原生touch事件只允许进行滚动和持续缩放操作 */
  html {
    touch-action: manipulation;
  }
  ```
  ```js
  // 在需要时主动触发对全局的手势禁用
  document.documentElement.style.touchAction = 'none'
  // 或者独立禁用某一片区域的手势操作
  document.getElementById('xxx').style.touchAction = 'none'
  // 不需要时还原，例如在抬手事件中处理
  document.addEventListener('touchend', function (event) {
    // 或 auto
    document.documentElement.style.touchAction = 'manipulation'
  });
  ```
> 移动web页面，input获取焦点弹出系统虚拟键盘时，挡住input
>   - element.scrollIntoView()
> ios日期转换NAN问题
>   - `new Date('2020/11/12 00:00:00')` iOS不支持 `-` 分割日期
> 禁止数字识别为电话号码
>   - `<meta name = "format-detection" content = "telephone=no">`
> transition闪屏
  ```css
  .box {
    -webkit-transform-style: preserve-3d;
    -webkit-backface-visibility: hidden;
    -webkit-perspective: 1000;
  }
  ```


<style lang="css">
  html { width: 100vw; }
  h1,h2,h3 {margin: 15px 0;border: 3px solid;border-left: none;border-radius: 0 10px 10px 0;padding: 10px;}
  h1 { border-color: #D7685B; }
  h2 { border-color: #E9B85B; }
  h3 { border-color: #72B95A; }
  p {margin: 5px 0;color: #666;}
  li {margin: 10px 0;}
  :not(pre):not(.hljs) > code{background-color: #F4FBFC;border-radius: 4px;color: #EC5E3C;padding: 4px;}
  blockquote{border-color: #3cae7c;padding: 10px 15px;border-radius: 0 5px 5px 0;}
  img {max-width: 420px;padding: 10px;border: 1px solid #fff;border-radius: 5px;user-select: none;-webkit-user-drag: none;transition: 500ms;margin: 0 auto;display: block;}
  img:hover {box-shadow: 0 7px 12px #ddd;border-color: #eee;}
</style>